namespace = f93_nomadic_raid

# from = event_target:Nomadic_bombardment
# root = event_target:nomadic_bombarder
country_event = {
	id = f93_nomadic_raid.1
	is_triggered_only = yes
	title = f93_nomadic_raid.2.name
	desc = f93_nomadic_raid.2.desc
	picture = GFX_evt_ship_in_orbit
	show_sound = event_finding_loot

	immediate = {
		event_target:nomadic_bombard_victim = { f93_set_income_stock_var_to_zero_effect = yes }
		event_target:nomadic_bombarder = { f93_set_income_stock_var_to_zero_effect = yes }
		event_target:Nomadic_bombardment = { f93_set_income_stock_var_to_zero_effect = yes }
	}

	option = {
		name = f93_nomadic_raid.2.a
		# custom_tooltip = f93_nomadic_raid.2.a.desc
		#Resource Raid
		f93_planet_raid_effect = yes
		#Research Raid
		if = {
			limit = {
				can_copy_random_tech_from = { who = from.owner }
				from = { is_capital = yes }
			}
			copy_random_tech_from = { who = from.owner	}
		}
		else_if = {
			limit = { can_copy_random_tech_from = { who = from.owner } }
			copy_random_tech_from = {
				who = from.owner
				progress = 0.1
			}
		}
	}
	after = {
		hidden_effect = {
			clear_global_event_target = Nomadic_bombardment
			clear_global_event_target = nomadic_bombarder
			clear_global_event_target = nomadic_bombard_victim
			if = {
				limit = { NOT = { from.owner = { is_at_war_with = root } } }
				from = { set_controller = from.owner }
			}
		}
	}
}

# A planets controller becomes a country not the same as the owner.
# Root = Planet
# From = Planet Owner
# FromFrom = Planet Controller (the one occupying)
planet_event = {
	id = f93_nomadic_raid.2
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_planet_flag = recently_raided_army }
		fromfrom = {
			has_civic = civic_nomadic_pirate
		}

	}
	immediate = {
		fromfrom = { save_global_event_target_as = nomadic_bombarder }
		from = { save_global_event_target_as = nomadic_bombard_victim }
		save_global_event_target_as = Nomadic_bombardment
		fromfrom = { country_event = { id = f93_nomadic_raid.1 } }

		if = {
			limit = { NOT = { has_planet_flag = recently_raided_army } }
			set_timed_planet_flag = {
				flag = recently_raided_army
				days = 3600
			}
			
		}

	}
}

country_event = {
	id = f93_nomadic_raid.3
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		event_target:got_raided_pays = {
			export_resource_stockpile_to_variable = { resource = energy variable = energy_payout }
			divide_variable = { which = energy_payout value = 5 }
			add_resource = { energy = -1 mult = energy_payout }
			f93_pays_reparation_effect = yes
		}
		event_target:raided_gets_pay = {
			set_variable = { which = energy_payout value = event_target:got_raided_pays.energy_payout }
			add_resource = { energy = 1 mult = energy_payout }
			f93_gets_reparation_effect = yes
		}
		clear_global_event_target = raided_gets_pay
		clear_global_event_target = got_raided_pays
	}
}